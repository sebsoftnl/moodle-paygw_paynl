{"version":3,"sources":["../src/startpayment.js"],"names":["getSelectedPaymentMethod","el","document","querySelector","value","startPayment","selector","addEventListener","e","preventDefault","dataset","currentTarget","Repository","createPayment","component","paymentarea","itemid","description","then","result","success","window","location","href","redirecturl","Notification","alert","Promise","resolve","fail","exception"],"mappings":"gfAwBA,OACA,OACA,O,ylBAOA,QAASA,CAAAA,CAAT,EAAoC,CAChC,GAAIC,CAAAA,CAAE,CAAGC,QAAQ,CAACC,aAAT,CAAuB,gDAAvB,CAAT,CACA,GAAkB,WAAd,QAAOF,CAAAA,CAAP,EAAoC,IAAP,GAAAA,CAAjC,CAA8C,CAC1C,MAAOA,CAAAA,CAAE,CAACG,KACb,CACD,MAAO,KACV,C,eAQ2B,QAAfC,CAAAA,YAAe,CAACC,CAAD,CAAc,CACtCJ,QAAQ,CAACC,aAAT,CAAuBG,CAAvB,EAAiCC,gBAAjC,CAAkD,OAAlD,CAA2D,SAAAC,CAAC,CAAI,CAC5DA,CAAC,CAACC,cAAF,GACA,GAAMC,CAAAA,CAAO,CAAGF,CAAC,CAACG,aAAF,CAAgBD,OAAhC,CAEAE,CAAU,CAACC,aAAX,CACQH,CAAO,CAACI,SADhB,CAEQJ,CAAO,CAACK,WAFhB,CAGQL,CAAO,CAACM,MAHhB,CAIQN,CAAO,CAACO,WAJhB,CAKQjB,CAAwB,EALhC,CAMQ,IANR,EAOEkB,IAPF,CAOO,SAAAC,CAAM,CAAI,CACb,GAAIA,CAAM,CAACC,OAAX,CAAoB,CAChBC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAuBJ,CAAM,CAACK,WACjC,CAFD,IAEO,CACHC,UAAaC,KAAb,CACI,cAAW,2BAAX,CAAwC,aAAxC,CADJ,CAEI,cAAW,6BAAX,CAA0C,aAA1C,CAFJ,CAGI,cAAW,+BAAX,CAA4C,aAA5C,CAHJ,CAKH,CACD,MAAOC,CAAAA,OAAO,CAACC,OAAR,EACV,CAlBD,EAkBGC,IAlBH,CAkBQJ,UAAaK,SAlBrB,CAmBH,CAvBD,CAwBH,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Payment implementation for paynl system.\n *\n * @package    paygw_paynl\n * @module     paygw_paynl/startpayment\n * @copyright  2021 Ing. R.J. van Dongen <rogier@sebsoft.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Repository from 'paygw_paynl/repository';\nimport Notification from 'core/notification';\nimport get_string from 'core/str';\n\n/**\n * Detect selected payment method (if we have one).\n *\n * @returns {String|null}\n */\nfunction getSelectedPaymentMethod() {\n    let el = document.querySelector('input[name=\"method\"][type=\"radio\"]:checked');\n    if (typeof el !== 'undefined' && el !== null) {\n        return el.value;\n    }\n    return null;\n}\n\n/**\n * Create payment in the backend and redirect.\n *\n * @param {String} selector\n * @returns {Promise}\n */\nexport const startPayment = (selector) => {\n    document.querySelector(selector).addEventListener('click', e => {\n        e.preventDefault();\n        const dataset = e.currentTarget.dataset;\n\n        Repository.createPayment(\n                dataset.component,\n                dataset.paymentarea,\n                dataset.itemid,\n                dataset.description,\n                getSelectedPaymentMethod(),\n                null,\n        ).then(result => {\n            if (result.success) {\n                window.location.href = result.redirecturl;\n            } else {\n                Notification.alert(\n                    get_string('startpayment:failed:title', 'paygw_paynl'),\n                    get_string('startpayment:failed:message', 'paygw_paynl'),\n                    get_string('startpayment:failed:btncancel', 'paygw_paynl')\n                );\n            }\n            return Promise.resolve();\n        }).fail(Notification.exception);\n    });\n};\n"],"file":"startpayment.min.js"}